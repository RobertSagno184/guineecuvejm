<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<div class="orders-list">
  <div class="page-header">
    <div>
      <h1>Gestion des commandes</h1>
      <p class="subtitle">Gérez toutes les commandes de vos clients</p>
    </div>
  </div>

  <!-- Filtres et recherche -->
  <div class="filters-section">
    <div class="filters">
      <div class="filter-group search-group">
        <label for="search-input">
          <i class="fas fa-search"></i> Recherche
        </label>
        <div class="search-input-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input
            id="search-input"
            type="text"
            placeholder="N° commande, client..."
            [value]="searchTerm()"
            (input)="onSearchChange($any($event.target).value)"
            class="search-input"
          />
        </div>
      </div>

      <div class="filter-group">
        <label for="status-filter">Statut</label>
        <select
          id="status-filter"
          [value]="selectedStatus()"
          (change)="onStatusChange($any($event.target).value)"
          class="select-input"
        >
          <option value="all">Tous les statuts</option>
          <option value="pending">En attente</option>
          <option value="processing">En traitement</option>
          <option value="shipped">Expédiée</option>
          <option value="delivered">Livrée</option>
          <option value="cancelled">Annulée</option>
        </select>
      </div>

      <div class="filter-group" *ngIf="uniqueCustomers().length > 0">
        <label for="customer-filter">Client</label>
        <select
          id="customer-filter"
          [value]="selectedCustomer()"
          (change)="onCustomerChange($any($event.target).value)"
          class="select-input"
        >
          <option value="all">Tous les clients</option>
          <option *ngFor="let customer of uniqueCustomers()" [value]="customer.id">
            {{ customer.name }}
          </option>
        </select>
      </div>

      <div class="filter-actions">
        <button class="btn-clear-filters" (click)="clearFilters()" type="button">
          <i class="fas fa-times"></i> Réinitialiser
        </button>
      </div>
    </div>
  </div>

  <!-- Actions en masse -->
  <div class="bulk-actions" *ngIf="selectedOrders().size > 0">
    <span class="selected-count">{{ selectedOrders().size }} commande(s) sélectionnée(s)</span>
    <button class="btn-danger" (click)="deleteSelectedOrders()" type="button">
      <i class="fas fa-trash"></i> Supprimer sélection
    </button>
  </div>

  <div class="orders-table-container" *ngIf="!isLoading(); else loading">
    <!-- Compteur et pagination header -->
    <div class="table-header">
      <div class="results-info">
        <span>{{ totalResults() }} résultat(s) trouvé(s)</span>
      </div>
      <div class="pagination-controls-top">
        <label for="items-per-page">Afficher :</label>
        <select
          id="items-per-page"
          [value]="itemsPerPage()"
          (change)="onItemsPerPageChange(+$any($event.target).value)"
          class="items-per-page-select"
        >
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
    </div>

    <table class="orders-table" *ngIf="paginatedOrders().length > 0; else noOrders">
      <thead>
        <tr>
          <th class="checkbox-column">
            <input
              type="checkbox"
              [checked]="selectAll()"
              (change)="toggleSelectAll()"
              title="Sélectionner tout"
            />
          </th>
          <th (click)="onSort('orderNumber')" class="sortable">
            N° Commande
            <i class="fas" [ngClass]="getSortIcon('orderNumber')"></i>
          </th>
          <th (click)="onSort('customerName')" class="sortable">
            Client
            <i class="fas" [ngClass]="getSortIcon('customerName')"></i>
          </th>
          <th (click)="onSort('total')" class="sortable">
            Montant
            <i class="fas" [ngClass]="getSortIcon('total')"></i>
          </th>
          <th (click)="onSort('status')" class="sortable">
            Statut
            <i class="fas" [ngClass]="getSortIcon('status')"></i>
          </th>
          <th (click)="onSort('createdAt')" class="sortable">
            Date
            <i class="fas" [ngClass]="getSortIcon('createdAt')"></i>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of paginatedOrders()">
          <td class="checkbox-column">
            <input
              type="checkbox"
              [checked]="isOrderSelected(order.id)"
              (change)="toggleOrderSelection(order.id)"
            />
          </td>
          <td>{{ order.orderNumber }}</td>
          <td>{{ order.customerName || 'N/A' }}</td>
          <td class="price">{{ formatCurrency(order.total) }}</td>
          <td>
            <span class="status-badge" [class]="'status-' + order.status">
              {{ getStatusLabel(order.status) }}
            </span>
          </td>
          <td>{{ formatDate(order.createdAt) }}</td>
          <td class="actions">
            <a [routerLink]="['/admin/orders', order.id]" class="btn-link" title="Voir détails">
              <i class="fas fa-eye"></i> Voir
            </a>
            <select
              [value]="order.status"
              (change)="updateStatus(order.id, $any($event.target).value)"
              class="status-select"
              title="Changer le statut"
            >
              <option value="pending">En attente</option>
              <option value="processing">En traitement</option>
              <option value="shipped">Expédiée</option>
              <option value="delivered">Livrée</option>
              <option value="cancelled">Annulée</option>
            </select>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #noOrders>
      <div class="empty-state">Aucune commande trouvée</div>
    </ng-template>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages() > 1">
      <button
        class="pagination-btn"
        [disabled]="currentPage() === 1"
        (click)="onPageChange(currentPage() - 1)"
        title="Page précédente"
      >
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <div class="pagination-pages">
        <button
          *ngFor="let page of getPageNumbers()"
          class="pagination-btn"
          [class.active]="page === currentPage()"
          (click)="onPageChange(page)"
        >
          {{ page }}
        </button>
      </div>

      <button
        class="pagination-btn"
        [disabled]="currentPage() === totalPages()"
        (click)="onPageChange(currentPage() + 1)"
        title="Page suivante"
      >
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <ng-template #loading>
    <div class="loading-state">Chargement...</div>
  </ng-template>
</div>

